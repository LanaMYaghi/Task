هذا المشروع عبارة عن API
مبني على Laravel 10
لإدارة المستخدمين، تسجيل الدخول، تسجيل الطلبات لترقية الصلاحيات إلى مشرف 
(midAdmin)، 
مع تحديث تلقائي لتوكن 
JWT
عند انتهاء صلاحيته، ودعم صلاحيات متعددة باستخدام مكتبة 
Spatie Laravel Permission.


النظام يدعم الأدوار التالية:

User: مستخدم عادي.

midAdmin: مستخدم تم ترقيته مؤقتًا بعد الموافقة على طلبه.

Admin: المشرف الكامل للنظام.

التسجيل وتسجيل الدخول
تسجيل مستخدم جديد

الرابط: POST /api/register

المعطيات المطلوبة:

name: اسم المستخدم

email: البريد الإلكتروني (يجب أن يكون فريد وصحيح)

password: كلمة المرور (تحتوي على حرف كبير ورقم على الأقل)

password_confirmation: تأكيد كلمة المرور

الدور الافتراضي: User

تسجيل الدخول

الرابط: POST /api/login

المعطيات المطلوبة:

email

password

الاستجابة: تعطيك توكن JWT صالح للوصول إلى باقي الـ API.

إدارة الجلسة (JWT)

تسجيل الخروج: POST /api/logout

تحديث التوكن تلقائي: POST /api/refresh

عرض معلومات المستخدم الحالي: GET /api/getMyInfo

ملاحظة: النظام يحتوي على Middleware لتحديث التوكن تلقائيًا عند انتهاء صلاحيته دون الحاجة لإعادة تسجيل الدخول.

إدارة الملف الشخصي للمستخدم

تحديث بياناتي: POST /api/updateMyProfile

حذف حسابي الشخصي: DELETE /api/deleteMyProfile

يمكن لكل مستخدم تعديل اسمه، بريده وكلمة المرور، وحذف حسابه، مع التحقق من صحة البيانات.

طلب ترقية الصلاحيات (User → midAdmin)
إرسال طلب ترقية

الرابط: POST /api/storeRequest

الشروط:

لا يمكن للمستخدم الذي هو Admin إرسال طلب.

لا يمكن إرسال أكثر من طلب واحد إذا كان الطلب السابق قيد الانتظار أو تمت الموافقة عليه.

الحالة الافتراضية للطلب: pending

عرض طلباتي

الرابط: GET /api/showMyRequests

الوصف: يعرض جميع الطلبات الخاصة بالمستخدم مع حالة كل طلب (pending, approved, rejected).

إدارة الطلبات بواسطة المشرف (Admin)
عرض جميع الطلبات

الرابط: GET /api/showAllRequests

الوصف: يعرض جميع الطلبات المرسلة من المستخدمين مع تفاصيلهم.

الموافقة أو رفض الطلب

الرابط: POST /api/answerRequest/{id}

المعطيات المطلوبة:

status: approved أو rejected أو pending

المنطق:

إذا تغير الطلب من pending → approved → يتم ترقية المستخدم إلى midAdmin

إذا تغير من pending → rejected → يبقى المستخدم User

إذا تغير من approved → rejected → المستخدم يعود إلى User

الطلبات المرفوضة لا يمكن تعديلها

الطلبات المعتمدة لا يمكن تحويلها إلى pending

إدارة المستخدمين بواسطة Admin
عرض المستخدمين

الرابط: GET /api/indexUsers

الوصف: يعرض جميع المستخدمين مع إمكانية البحث بحسب الدور (User أو Admin)

تحديث المستخدمين

الرابط: POST /api/updateMyProfile (للمستخدم الحالي)

الوصف: تحديث الاسم، البريد أو كلمة المرور.

حذف المستخدمين

الرابط: DELETE /api/destroyUsers/{id}

الشروط:

لا يمكن للمشرف حذف حسابه الشخصي

يمكن حذف أي مستخدم آخر إذا كان موجود

الهيكلية والتقنيات المستخدمة

Laravel 10

JWTAuth لإدارة الجلسات والتوكن

Spatie Laravel Permission لإدارة الأدوار والصلاحيات

Middleware لتحديث التوكن تلقائيًا عند انتهاء صلاحيته

Database: جداول المستخدمين، طلبات الترقيات، والأدوار والصلاحيات

ملاحظات هامة

جميع المسارات المحمية تتطلب التوكن JWT في الهيدر:

Authorization: Bearer {token}


المستخدم العادي يمكنه:

تعديل ملفه الشخصي

حذف حسابه

إرسال طلب ترقية

عرض حالة طلباته

Admin يمكنه:

عرض وحذف المستخدمين

عرض كل الطلبات

تحديث حالة الطلبات وإدارة الأدوار حسب المنطق المحدد
